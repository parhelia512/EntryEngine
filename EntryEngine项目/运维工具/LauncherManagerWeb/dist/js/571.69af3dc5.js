"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[571],{7388:function(e,t,o){o.d(t,{Z:function(){return u}});var n=o(3396),a=o(7139);const s=e=>((0,n.dD)("data-v-3dc945be"),e=e(),(0,n.Cn)(),e),l={key:0},i=s((()=>(0,n._)("option",{class:"optitle"},"选择命令",-1))),m=["value"];function r(e,t,o,s,r,c){const d=(0,n.up)("van-field"),h=(0,n.up)("van-form"),u=(0,n.up)("van-dialog");return(0,n.wg)(),(0,n.j4)(u,{width:"15rem",show:r.commandShow,"onUpdate:show":t[2]||(t[2]=e=>r.commandShow=e),title:"命令","before-close":c.commandClose,"show-cancel-button":""},{title:(0,n.w5)((()=>[0==r.commands.length?((0,n.wg)(),(0,n.iD)("span",l,"命令")):(0,n.kq)("",!0),r.commands.length>0?((0,n.wg)(),(0,n.iD)("select",{key:1,ref:"select",onChange:t[0]||(t[0]=(...e)=>c.selectCommand&&c.selectCommand(...e))},[i,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.commands,((e,t)=>((0,n.wg)(),(0,n.iD)("option",{class:"op",value:e},(0,a.zw)(e),9,m)))),256))],544)):(0,n.kq)("",!0)])),default:(0,n.w5)((()=>[(0,n.Wm)(h,{"label-width":"4rem",onSubmit:e.onSubmitCommand,ref:"commandFrom","validate-trigger":"onSubmit"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{modelValue:r.commandFrom.LaunchCommand,"onUpdate:modelValue":t[1]||(t[1]=e=>r.commandFrom.LaunchCommand=e),name:"LaunchCommand",label:"执行命令",type:"textarea",rows:"10",placeholder:"输入命令",rules:[{required:!0,message:"请输入命令"}]},null,8,["modelValue"])])),_:1},8,["onSubmit"])])),_:1},8,["show","before-close"])}var c={name:"CommandComponent",components:{},props:{chooseList:Array,show:{type:Boolean,default:!1}},data(){return{commandShow:!1,commandFrom:{LaunchCommand:""},commands:[]}},computed:{},watch:{show:function(e){this.commandShow=e,this.commandFrom.LaunchCommand="",e&&this.getCommands()}},methods:{commandClose(e,t){return"confirm"==e?new Promise((e=>{this.$IMBSProxy.CallCommand(this.chooseList,this.commandFrom.LaunchCommand,(e=>{e&&(this.$Toast("操作成功"),this.$emit("submit"),this.$emit("close"))})).then((()=>e(!0))).catch((()=>e(!1)))})):(this.$emit("close"),!0)},getCommands(){this.$IMBSProxy.GetCommands(this.chooseList[0],(e=>this.commands=e))},getCommandsList(){return console.log("getCommandsList",this.$refs.dd),this.commands},selectCommand(){const e=this.$refs.select;console.log("selectCommand",e.options[e.selectedIndex]),e.selectedIndex>0&&(this.commandFrom.LaunchCommand+=e.options[e.selectedIndex].value+"\r\n",e.selectedIndex=0)}},mounted(){}},d=o(89);const h=(0,d.Z)(c,[["render",r],["__scopeId","data-v-3dc945be"]]);var u=h},5471:function(e,t,o){o.d(t,{Z:function(){return C}});var n=o(3396),a=o(9242),s=o(7139);const l=e=>((0,n.dD)("data-v-d9de0d1c"),e=e(),(0,n.Cn)(),e),i={class:"float-btn"},m={class:"btn-list"},r=l((()=>(0,n._)("span",null,"置顶",-1))),c=[r],d=["onClick"],h=l((()=>(0,n._)("span",null,"触底",-1))),u=[h];function p(e,t,o,l,r,h){const p=(0,n.up)("van-icon");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n._)("div",m,[(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-top",onClick:t[0]||(t[0]=(0,a.iM)((e=>h.choose("goTop")),["stop"]))},c)),[[a.F8,o.goTop]]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(h.showList,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-"+t,onClick:(0,a.iM)((o=>h.choose(t,e)),["stop"])},[(0,n._)("span",null,(0,s.zw)(e),1)],8,d)))),128)),(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-bottom",onClick:t[1]||(t[1]=(0,a.iM)((e=>h.choose("goBottom")),["stop"]))},u)),[[a.F8,o.goBottom]])]),(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-more",onClick:t[2]||(t[2]=(0,a.iM)((e=>r.showMore=!r.showMore),["stop"]))},[(0,n.Wm)(p,{name:r.showMore?"arrow-up":"arrow-down"},null,8,["name"])])),[[a.F8,h.hidden]])])}var w={components:{},props:{list:Array,showNum:{type:Number,default:3},goTop:Boolean,goBottom:Boolean},data(){return{showMore:!1}},computed:{hidden(){return this.list&&this.list.length>this.showNum},showList(){let e=[],t=this.list?this.list.length:0;!this.showMore&&this.showNum<t&&(t=this.showNum);for(let o=0;o<t;o++)e.push(this.list[o]);return e}},methods:{choose(e,t){this.$emit("choose",e,t)}},mounted(){}},g=o(89);const f=(0,g.Z)(w,[["render",p],["__scopeId","data-v-d9de0d1c"]]);var C=f},5571:function(e,t,o){o.r(t),o.d(t,{default:function(){return _}});var n=o(3396),a=o(7139),s=o(9242);const l={class:"container"},i={style:{display:"flex","flex-direction":"row","align-items":"center"}},m=["textContent"],r={class:"page-block"},c=(0,n.Uk)("调试"),d=(0,n.Uk)("信息"),h=(0,n.Uk)("警告"),u=(0,n.Uk)("错误"),p=(0,n.Uk)(" 普通查询 "),w=(0,n.Uk)(" 分组查询 "),g={class:"block",ref:"detailBlock",id:"detailBlock"},f={id:"detail"};function C(e,t,o,C,v,y){const b=(0,n.up)("van-icon"),k=(0,n.up)("van-nav-bar"),T=(0,n.up)("van-cell"),_=(0,n.up)("van-cell-group"),W=(0,n.up)("van-pagination"),x=(0,n.up)("van-field"),L=(0,n.up)("van-checkbox"),S=(0,n.up)("van-checkbox-group"),V=(0,n.up)("van-button"),B=(0,n.up)("van-col"),M=(0,n.up)("van-row"),R=(0,n.up)("van-form"),D=(0,n.up)("van-popup"),$=(0,n.up)("van-datetime-picker"),U=(0,n.up)("van-action-sheet"),F=(0,n.up)("FloatBtn"),I=(0,n.up)("van-overlay"),N=(0,n.up)("Command");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(k,{title:"日志("+y.serviceName+")","left-arrow":"",onClickLeft:t[2]||(t[2]=t=>e.$router.go(-1)),style:{width:"100%"}},{right:(0,n.w5)((()=>[(0,n._)("div",i,[(0,n._)("span",{onClick:t[0]||(t[0]=e=>v.commandShow=!0),style:{padding:"0 10px"}},"命令"),(0,n.Wm)(b,{name:"filter-o",size:"18",onClick:t[1]||(t[1]=e=>v.filter=!0)})])])),_:1},8,["title"]),(0,n.Wm)(_,{class:"list"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(v.list,((e,t)=>((0,n.wg)(),(0,n.j4)(T,{key:"list-item-"+t,title:e.Record.Time,value:e.Count,style:(0,a.j5)("white-space: pre-line;"+(e.Record.ContentMore?"cursor: pointer;":"")+"color:"+["#ccc","#000","orange","red"][e.Record.Level]),onClick:t=>y.detail(e)},{label:(0,n.w5)((()=>[(0,n._)("div",{textContent:(0,a.zw)(e.Record.ContentShow)},null,8,m)])),_:2},1032,["title","value","style","onClick"])))),128))])),_:1}),(0,n._)("div",r,[(0,n._)("div",{class:(0,a.C_)(["page-btn",{"page-btn-disabled":1==v.page}]),onClick:t[3]||(t[3]=e=>1==v.page?null:v.page=1)},[(0,n.Wm)(b,{name:"arrow-left",class:"icon-1"}),(0,n.Wm)(b,{name:"arrow-left",class:"icon-2"})],2),(0,n.Wm)(W,{modelValue:v.page,"onUpdate:modelValue":t[4]||(t[4]=e=>v.page=e),"page-count":v.pageCount,"show-page-size":7},{"prev-text":(0,n.w5)((()=>[(0,n.Wm)(b,{name:"arrow-left"})])),"next-text":(0,n.w5)((()=>[(0,n.Wm)(b,{name:"arrow"})])),page:(0,n.w5)((({text:e})=>[(0,n.Uk)((0,a.zw)(e),1)])),_:1},8,["modelValue","page-count"]),(0,n._)("div",{class:(0,a.C_)(["page-btn",{"page-btn-disabled":v.page==v.pageCount}]),onClick:t[5]||(t[5]=e=>v.page==v.pageCount?null:v.page=v.pageCount)},[(0,n.Wm)(b,{name:"arrow",class:"icon-1",style:{right:"50%"}}),(0,n.Wm)(b,{name:"arrow",class:"icon-2"})],2)]),(0,n.Wm)(D,{show:v.filter,"onUpdate:show":t[15]||(t[15]=e=>v.filter=e),position:"right",style:{height:"100%",width:"80%"}},{default:(0,n.w5)((()=>[(0,n.Wm)(R,{onSubmit:y.onSubmit,ref:"from","validate-trigger":"onSubmit","label-width":"56"},{default:(0,n.w5)((()=>[(0,n.Wm)(x,{modelValue:v.from.startTime,"onUpdate:modelValue":t[6]||(t[6]=e=>v.from.startTime=e),onClick:t[7]||(t[7]=e=>{v.showTime=!0,v.sheetTimeType="start"}),name:"startTime",label:"开始时间"},null,8,["modelValue"]),(0,n.Wm)(x,{modelValue:v.from.endTime,"onUpdate:modelValue":t[8]||(t[8]=e=>v.from.endTime=e),onClick:t[9]||(t[9]=e=>{v.showTime=!0,v.sheetTimeType="end"}),name:"endTime",label:"结束时间"},null,8,["modelValue"]),(0,n.Wm)(x,{modelValue:v.from.content,"onUpdate:modelValue":t[10]||(t[10]=e=>v.from.content=e),name:"content",label:"内容"},null,8,["modelValue"]),(0,n.Wm)(x,{modelValue:v.from.param,"onUpdate:modelValue":t[11]||(t[11]=e=>v.from.param=e),name:"param",label:"参数"},null,8,["modelValue"]),(0,n.Wm)(x,{name:"type",label:"","label-width":"0"},{input:(0,n.w5)((()=>[(0,n.Wm)(S,{modelValue:v.from.type,"onUpdate:modelValue":t[12]||(t[12]=e=>v.from.type=e),direction:"horizontal"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{class:"type-check",name:"0"},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(L,{class:"type-check",name:"1"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(L,{class:"type-check",name:"2"},{default:(0,n.w5)((()=>[h])),_:1}),(0,n.Wm)(L,{class:"type-check",name:"3"},{default:(0,n.w5)((()=>[u])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(M,{gutter:"20",style:{margin:"0 16px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(B,{span:"12"},{default:(0,n.w5)((()=>[(0,n.Wm)(V,{style:{"margin-top":"30px",flex:"1"},round:"",block:"",type:"info","native-type":"submit",onClick:t[13]||(t[13]=e=>v.submitType=0)},{default:(0,n.w5)((()=>[p])),_:1})])),_:1}),(0,n.Wm)(B,{span:"12"},{default:(0,n.w5)((()=>[(0,n.Wm)(V,{style:{"margin-top":"30px",flex:"1"},round:"",block:"",type:"info","native-type":"submit",onClick:t[14]||(t[14]=e=>v.submitType=1)},{default:(0,n.w5)((()=>[w])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["show"]),(0,n.Wm)(U,{modelValue:v.showTime,"onUpdate:modelValue":t[17]||(t[17]=e=>v.showTime=e)},{default:(0,n.w5)((()=>[(0,n.Wm)($,{modelValue:v.sheetTime,"onUpdate:modelValue":t[16]||(t[16]=e=>v.sheetTime=e),type:"datetime",onConfirm:y.sureTime},null,8,["modelValue","onConfirm"])])),_:1},8,["modelValue"]),(0,n.Wm)(I,{show:v.overlay,onClick:t[21]||(t[21]=e=>v.overlay=!1)},{default:(0,n.w5)((()=>[(0,n._)("div",{class:"wrapper",onClick:t[20]||(t[20]=(0,s.iM)((()=>{}),["stop"]))},[(0,n.Wm)(k,{"left-arrow":"",onClickLeft:t[18]||(t[18]=e=>v.overlay=!1),title:v.selectRow.Record.Time,"right-text":"关闭",onClickRight:t[19]||(t[19]=e=>v.overlay=!1),style:{width:"100%"}},{right:(0,n.w5)((()=>[(0,n.Wm)(b,{name:"cross",size:"18"})])),_:1},8,["title"]),(0,n._)("div",g,[(0,n._)("p",f,(0,a.zw)(v.selectRow.Record.Content),1)],512),(0,n.Wm)(F,{goTop:!0,goBottom:!0,onChoose:y.chooseFloatBtn},null,8,["onChoose"])])])),_:1},8,["show"]),(0,n.Wm)(N,{show:v.commandShow,chooseList:[y.serviceName],onClose:t[22]||(t[22]=e=>v.commandShow=!1),onSubmit:t[23]||(t[23]=e=>y.getLog())},null,8,["show","chooseList"])])}var v=o(5471),y=o(7388),b={name:"ServiceLog",components:{FloatBtn:v.Z,Command:y.Z},data(){return{filter:!1,from:{},showTime:!1,sheetTime:new Date,sheetTimeType:0,page:1,pageCount:0,list:[],submitType:0,overlay:!1,selectRow:{Record:{}},commandShow:!1}},computed:{serviceName(){let e=this.$route.query.name;return e}},watch:{page:function(e){console.log("page--\x3e",e),this.getLog()}},methods:{getLog(){let e=[];for(let o of this.from.type)e.push(Number(o));console.log("getLog--\x3e",this.submitType);const t=e=>{this.list=e.Models;for(const t in this.list){let e=this.list[t].Record.Params;for(const o in e){let n="{"+o+"}";this.list[t].Record.Content=`${this.list[t].Record.Content.replace(n,e[o])}`}this.list[t].Record.Content.length>200?(this.list[t].Record.ContentShow=this.list[t].Record.Content.slice(0,200)+" ...",this.list[t].Record.ContentMore=!0):(this.list[t].Record.ContentShow=this.list[t].Record.Content,this.list[t].Record.ContentMore=!1)}this.pageCount=1+((e.Count-1)/e.PageSize|0)};0==this.submitType?this.$IMBSProxy.GetLog(this.serviceName,this.from.startTime?new Date(this.from.startTime).getTime():0,this.from.endTime?new Date(this.from.endTime).getTime():0,30,this.page-1,this.from.content,this.from.param,e,t):this.$IMBSProxy.GroupLog(this.serviceName,this.from.startTime?new Date(this.from.startTime).getTime():0,this.from.endTime?new Date(this.from.endTime).getTime():0,this.from.content,this.from.param,e,t)},onSubmit(){console.log("submit",this.from),this.$store.commit("setLogSearch",this.from),this.getLog(),this.filter=!1},sureTime(e){console.log("sureTime",this.sheetTimeType,e),"start"==this.sheetTimeType?this.from.startTime=e.format("yyyy-MM-dd hh:mm"):this.from.endTime=e.format("yyyy-MM-dd hh:mm"),this.showTime=!1,this.sheetTime=new Date},detail(e){console.log("detail---\x3e",e),this.selectRow=e,e.Record.ContentMore&&(this.overlay=!0)},chooseFloatBtn(e){switch(console.log("chooseFloatBtn",e),e){case"goTop":document.getElementById("detailBlock").scrollTop=0;break;case"goBottom":document.getElementById("detailBlock").scrollTop=document.getElementById("detail").clientHeight;break;default:break}}},mounted(){this.from=this.$store.state.logSearch,console.log("logSearch",this.from),this.getLog(),this.$nextTick().then((()=>{console.log("this.$refs",this.$refs),this.$refs.detailBlock.addEventListener("touchmove",(e=>e.stopPropagation()),!1)}))}},k=o(89);const T=(0,k.Z)(b,[["render",C],["__scopeId","data-v-8cf05316"]]);var _=T}}]);