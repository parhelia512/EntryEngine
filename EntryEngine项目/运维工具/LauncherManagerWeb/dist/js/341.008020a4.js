"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[341],{3511:function(e,t,o){o.d(t,{Z:function(){return m}});var n=o(3396);function a(e,t,o,a,l,i){const s=(0,n.up)("van-field"),m=(0,n.up)("van-form"),r=(0,n.up)("van-dialog");return(0,n.wg)(),(0,n.j4)(r,{modelValue:l.commandShow,"onUpdate:modelValue":t[1]||(t[1]=e=>l.commandShow=e),title:"命令","before-close":i.commandClose,"show-cancel-button":""},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{onSubmit:i.onSubmitCommand,ref:"commandFrom","validate-trigger":"onSubmit"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{modelValue:l.commandFrom.LaunchCommand,"onUpdate:modelValue":t[0]||(t[0]=e=>l.commandFrom.LaunchCommand=e),name:"LaunchCommand",label:"执行命令",type:"textarea",rows:"10",placeholder:"输入命令",rules:[{required:!0,message:"请输入命令"}]},null,8,["modelValue"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue","before-close"])}var l={name:"CommandComponent",components:{},props:{chooseList:Array,show:{type:Boolean,default:!1}},data(){return{commandShow:!1,commandFrom:{LaunchCommand:""}}},computed:{},watch:{show:function(e){this.commandShow=e,this.commandFrom.LaunchCommand=""}},methods:{commandClose(e,t){"confirm"==e?(this.$refs.commandFrom.submit(),t(!1)):(t(),this.$emit("close"))},onSubmitCommand(){console.log("onSubmitCommand===》",this.commandFrom),this.$IMBSProxy.CallCommand(this.chooseList,this.commandFrom.LaunchCommand,(e=>{e&&(this.$Toast("操作成功"),this.$emit("submit"),this.$emit("close"))}))}},mounted(){}},i=o(89);const s=(0,i.Z)(l,[["render",a],["__scopeId","data-v-f4027850"]]);var m=s},9959:function(e,t,o){o.d(t,{Z:function(){return v}});var n=o(3396),a=o(9242),l=o(7139);const i=e=>((0,n.dD)("data-v-af82bad6"),e=e(),(0,n.Cn)(),e),s={class:"float-btn"},m={class:"btn-list"},r=i((()=>(0,n._)("span",null,"置顶",-1))),c=[r],d=["onClick"],u=i((()=>(0,n._)("span",null,"触底",-1))),h=[u];function p(e,t,o,i,r,u){const p=(0,n.up)("van-icon");return(0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("div",m,[(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-top",onClick:t[0]||(t[0]=(0,a.iM)((e=>u.choose("goTop")),["stop"]))},c)),[[a.F8,o.goTop]]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(u.showList,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-"+t,onClick:(0,a.iM)((o=>u.choose(t,e)),["stop"])},[(0,n._)("span",null,(0,l.zw)(e),1)],8,d)))),128)),(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-bottom",onClick:t[1]||(t[1]=(0,a.iM)((e=>u.choose("goBottom")),["stop"]))},h)),[[a.F8,o.goBottom]])]),(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"btn",key:"float-btn-more",onClick:t[2]||(t[2]=(0,a.iM)((e=>r.showMore=!r.showMore),["stop"]))},[(0,n.Wm)(p,{name:r.showMore?"arrow-up":"arrow-down"},null,8,["name"])])),[[a.F8,u.hidden]])])}var w={components:{},props:{list:Array,showNum:{type:Number,default:3},goTop:Boolean,goBottom:Boolean},data(){return{showMore:!1}},computed:{hidden(){return this.list&&this.list.length>this.showNum},showList(){let e=[],t=this.list.length;!this.showMore&&this.showNum<t&&(t=this.showNum);for(let o=0;o<t;o++)e.push(this.list[o]);return e}},methods:{choose(e,t){this.$emit("choose",e,t)}},mounted(){}},f=o(89);const g=(0,f.Z)(w,[["render",p],["__scopeId","data-v-af82bad6"]]);var v=g},8341:function(e,t,o){o.r(t),o.d(t,{default:function(){return _}});var n=o(3396),a=o(7139),l=o(9242);const i={class:"container"},s={style:{display:"flex","flex-direction":"row","align-items":"center"}},m=["textContent"],r={class:"page-block"},c=(0,n.Uk)("调试"),d=(0,n.Uk)("信息"),u=(0,n.Uk)("警告"),h=(0,n.Uk)("错误"),p=(0,n.Uk)(" 普通查询 "),w=(0,n.Uk)(" 分组查询 "),f={class:"block",ref:"detailBlock",id:"detailBlock"},g={id:"detail"};function v(e,t,o,v,y,C){const b=(0,n.up)("van-icon"),T=(0,n.up)("van-nav-bar"),k=(0,n.up)("van-cell"),_=(0,n.up)("van-cell-group"),W=(0,n.up)("van-pagination"),V=(0,n.up)("van-field"),S=(0,n.up)("van-checkbox"),x=(0,n.up)("van-checkbox-group"),L=(0,n.up)("van-button"),B=(0,n.up)("van-col"),R=(0,n.up)("van-row"),M=(0,n.up)("van-form"),U=(0,n.up)("van-popup"),$=(0,n.up)("van-datetime-picker"),F=(0,n.up)("van-action-sheet"),D=(0,n.up)("FloatBtn"),N=(0,n.up)("van-overlay"),z=(0,n.up)("Command");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(T,{title:"日志","left-arrow":"",onClickLeft:t[2]||(t[2]=t=>e.$router.go(-1)),style:{width:"100%"}},{right:(0,n.w5)((()=>[(0,n._)("div",s,[(0,n._)("span",{onClick:t[0]||(t[0]=e=>y.commandShow=!0),style:{padding:"0 10px"}},"命令"),(0,n.Wm)(b,{name:"filter-o",size:"18",onClick:t[1]||(t[1]=e=>y.filter=!0)})])])),_:1}),(0,n.Wm)(_,{class:"list"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(y.list,((e,t)=>((0,n.wg)(),(0,n.j4)(k,{key:"list-item-"+t,title:e.Record.Time,value:e.Count,style:(0,a.j5)("white-space: pre-line;"+(e.Record.ContentMore?"cursor: pointer;":"")+"color:"+["#ccc","#000","orange","red"][e.Record.Level]),onClick:t=>C.detail(e)},{label:(0,n.w5)((()=>[(0,n._)("div",{textContent:(0,a.zw)(e.Record.ContentShow)},null,8,m)])),_:2},1032,["title","value","style","onClick"])))),128))])),_:1}),(0,n._)("div",r,[(0,n._)("div",{class:(0,a.C_)(["page-btn",{"page-btn-disabled":1==y.page}]),onClick:t[3]||(t[3]=e=>1==y.page?null:y.page=1)},[(0,n.Wm)(b,{name:"arrow-left",class:"icon-1"}),(0,n.Wm)(b,{name:"arrow-left",class:"icon-2"})],2),(0,n.Wm)(W,{modelValue:y.page,"onUpdate:modelValue":t[4]||(t[4]=e=>y.page=e),"page-count":y.pageCount,"show-page-size":7},{"prev-text":(0,n.w5)((()=>[(0,n.Wm)(b,{name:"arrow-left"})])),"next-text":(0,n.w5)((()=>[(0,n.Wm)(b,{name:"arrow"})])),page:(0,n.w5)((({text:e})=>[(0,n.Uk)((0,a.zw)(e),1)])),_:1},8,["modelValue","page-count"]),(0,n._)("div",{class:(0,a.C_)(["page-btn",{"page-btn-disabled":y.page==y.pageCount}]),onClick:t[5]||(t[5]=e=>y.page==y.pageCount?null:y.page=y.pageCount)},[(0,n.Wm)(b,{name:"arrow",class:"icon-1",style:{right:"50%"}}),(0,n.Wm)(b,{name:"arrow",class:"icon-2"})],2)]),(0,n.Wm)(U,{modelValue:y.filter,"onUpdate:modelValue":t[15]||(t[15]=e=>y.filter=e),position:"right",style:{height:"100%",width:"80%"}},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{onSubmit:C.onSubmit,ref:"from","validate-trigger":"onSubmit","label-width":"56"},{default:(0,n.w5)((()=>[(0,n.Wm)(V,{modelValue:y.from.startTime,"onUpdate:modelValue":t[6]||(t[6]=e=>y.from.startTime=e),onClick:t[7]||(t[7]=e=>{y.showTime=!0,y.sheetTimeType="start"}),name:"startTime",label:"开始时间"},null,8,["modelValue"]),(0,n.Wm)(V,{modelValue:y.from.endTime,"onUpdate:modelValue":t[8]||(t[8]=e=>y.from.endTime=e),onClick:t[9]||(t[9]=e=>{y.showTime=!0,y.sheetTimeType="end"}),name:"endTime",label:"结束时间"},null,8,["modelValue"]),(0,n.Wm)(V,{modelValue:y.from.content,"onUpdate:modelValue":t[10]||(t[10]=e=>y.from.content=e),name:"content",label:"内容"},null,8,["modelValue"]),(0,n.Wm)(V,{modelValue:y.from.param,"onUpdate:modelValue":t[11]||(t[11]=e=>y.from.param=e),name:"param",label:"参数"},null,8,["modelValue"]),(0,n.Wm)(V,{name:"type",label:"","label-width":"0"},{input:(0,n.w5)((()=>[(0,n.Wm)(x,{modelValue:y.from.type,"onUpdate:modelValue":t[12]||(t[12]=e=>y.from.type=e),direction:"horizontal"},{default:(0,n.w5)((()=>[(0,n.Wm)(S,{class:"type-check",name:"0"},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(S,{class:"type-check",name:"1"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(S,{class:"type-check",name:"2"},{default:(0,n.w5)((()=>[u])),_:1}),(0,n.Wm)(S,{class:"type-check",name:"3"},{default:(0,n.w5)((()=>[h])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(R,{gutter:"20",style:{margin:"0 16px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(B,{span:"12"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{style:{"margin-top":"30px",flex:"1"},round:"",block:"",type:"info","native-type":"submit",onClick:t[13]||(t[13]=e=>y.submitType=0)},{default:(0,n.w5)((()=>[p])),_:1})])),_:1}),(0,n.Wm)(B,{span:"12"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{style:{"margin-top":"30px",flex:"1"},round:"",block:"",type:"info","native-type":"submit",onClick:t[14]||(t[14]=e=>y.submitType=1)},{default:(0,n.w5)((()=>[w])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"]),(0,n.Wm)(F,{modelValue:y.showTime,"onUpdate:modelValue":t[17]||(t[17]=e=>y.showTime=e)},{default:(0,n.w5)((()=>[(0,n.Wm)($,{modelValue:y.sheetTime,"onUpdate:modelValue":t[16]||(t[16]=e=>y.sheetTime=e),type:"datetime",onConfirm:C.sureTime},null,8,["modelValue","onConfirm"])])),_:1},8,["modelValue"]),(0,n.Wm)(N,{show:y.overlay,onClick:t[21]||(t[21]=e=>y.overlay=!1)},{default:(0,n.w5)((()=>[(0,n._)("div",{class:"wrapper",onClick:t[20]||(t[20]=(0,l.iM)((()=>{}),["stop"]))},[(0,n.Wm)(T,{"left-arrow":"",onClickLeft:t[18]||(t[18]=e=>y.overlay=!1),title:y.selectRow.Record.Time,"right-text":"关闭",onClickRight:t[19]||(t[19]=e=>y.overlay=!1),style:{width:"100%"}},{right:(0,n.w5)((()=>[(0,n.Wm)(b,{name:"cross",size:"18"})])),_:1},8,["title"]),(0,n._)("div",f,[(0,n._)("p",g,(0,a.zw)(y.selectRow.Record.Content),1)],512),(0,n.Wm)(D,{goTop:!0,goBottom:!0,onChoose:C.chooseFloatBtn},null,8,["onChoose"])])])),_:1},8,["show"]),(0,n.Wm)(z,{show:y.commandShow,chooseList:[C.serviceName],onClose:t[22]||(t[22]=e=>y.commandShow=!1),onSubmit:t[23]||(t[23]=e=>C.getLog())},null,8,["show","chooseList"])])}var y=o(9959),C=o(3511),b={name:"ServiceLog",components:{FloatBtn:y.Z,Command:C.Z},data(){return{filter:!1,from:{},showTime:!1,sheetTime:new Date,sheetTimeType:0,page:1,pageCount:0,list:[],submitType:0,overlay:!1,selectRow:{Record:{}},commandShow:!1}},computed:{serviceName(){let e=this.$route.query.name;return e}},watch:{page:function(e){console.log("page--\x3e",e),this.getLog()}},methods:{getLog(){let e=[];for(let o of this.from.type)e.push(Number(o));console.log("getLog--\x3e",this.submitType);const t=e=>{this.list=e.Models;for(const t in this.list){let e=this.list[t].Record.Params;for(const o in e){let n="{"+o+"}";this.list[t].Record.Content=`${this.list[t].Record.Content.replace(n,e[o])}`}this.list[t].Record.Content.length>200?(this.list[t].Record.ContentShow=this.list[t].Record.Content.slice(0,200)+" ...",this.list[t].Record.ContentMore=!0):(this.list[t].Record.ContentShow=this.list[t].Record.Content,this.list[t].Record.ContentMore=!1)}console.log("response----\x3e"),this.pageCount=1+((e.Count-1)/e.PageSize|0)};0==this.submitType?this.$IMBSProxy.GetLog(this.serviceName,this.from.startTime?new Date(this.from.startTime).getTime():0,this.from.endTime?new Date(this.from.endTime).getTime():0,30,this.page-1,this.from.content,this.from.param,e,t):this.$IMBSProxy.GroupLog(this.serviceName,this.from.startTime?new Date(this.from.startTime).getTime():0,this.from.endTime?new Date(this.from.endTime).getTime():0,this.from.content,this.from.param,e,t)},onSubmit(){console.log("submit",this.from),this.$store.commit("setLogSearch",this.from),this.getLog(),this.filter=!1},sureTime(e){console.log("sureTime",this.sheetTimeType,e),"start"==this.sheetTimeType?this.from.startTime=e.format("yyyy-MM-dd hh:mm"):this.from.endTime=e.format("yyyy-MM-dd hh:mm"),this.showTime=!1,this.sheetTime=new Date},detail(e){console.log("detail---\x3e",e),this.selectRow=e,e.Record.ContentMore&&(this.overlay=!0)},chooseFloatBtn(e){switch(console.log("chooseFloatBtn",e),e){case"goTop":document.getElementById("detailBlock").scrollTop=0;break;case"goBottom":document.getElementById("detailBlock").scrollTop=document.getElementById("detail").clientHeight;break;default:break}}},mounted(){console.log("logSearch--\x3e",this.$store.state.logSearch),this.from=this.$store.state.logSearch,this.getLog(),this.$nextTick().then((()=>{this.$refs.detailBlock.addEventListener("touchmove",(e=>e.stopPropagation()),!1)}))}},T=o(89);const k=(0,T.Z)(b,[["render",v],["__scopeId","data-v-1143599c"]]);var _=k}}]);